[ '<p>Since <a href="https://letsencrypt.org/"><em>Let\'s Encrypt</em></a> will be coming out <a href="https://letsencrypt.org/2015/11/12/public-beta-timing.html">soon</a>, I thought I\'d try it on my Site. <em>Let\'s Encrypts</em> infrastructure is actually fully operational already. They still label it as being in beta, because the client has some (<a href="https://github.com/letsencrypt/letsencrypt/issues">around 400</a>) bugs. My Site runs on Node.js using Express on <a href="https://alpinelinux.org/"><em>Alpine Linux</em></a>. The guide should work on pretty much any Linux system, since both <em>Node.js</em> and <em>Let\'s Encrypt</em> are made to be as cross-platform-compatible as possible.</p>',
  'Since <a href="https://letsencrypt.org/"><em>Let\'s Encrypt</em></a> will be coming out <a href="https://letsencrypt.org/2015/11/12/public-beta-timing.html">soon</a>, I thought I\'d try it on my Site. <em>Let\'s Encrypts</em> infrastructure is actually fully operational already. They still label it as being in beta, because the client has some (<a href="https://github.com/letsencrypt/letsencrypt/issues">around 400</a>) bugs. My Site runs on Node.js using Express on <a href="https://alpinelinux.org/"><em>Alpine Linux</em></a>. The guide should work on pretty much any Linux system, since both <em>Node.js</em> and <em>Let\'s Encrypt</em> are made to be as cross-platform-compatible as possible.',
  index: 104,
  input: '<h1 id="letsencryptexpress0"><a href="/anotherblog/letsencrypt-express">Let\'s encrypt Express</a></h1>\n\n<p>Since <a href="https://letsencrypt.org/"><em>Let\'s Encrypt</em></a> will be coming out <a href="https://letsencrypt.org/2015/11/12/public-beta-timing.html">soon</a>, I thought I\'d try it on my Site. <em>Let\'s Encrypts</em> infrastructure is actually fully operational already. They still label it as being in beta, because the client has some (<a href="https://github.com/letsencrypt/letsencrypt/issues">around 400</a>) bugs. My Site runs on Node.js using Express on <a href="https://alpinelinux.org/"><em>Alpine Linux</em></a>. The guide should work on pretty much any Linux system, since both <em>Node.js</em> and <em>Let\'s Encrypt</em> are made to be as cross-platform-compatible as possible.</p>\n\n<p>I\'ll be covering three things in this guide. <strong>Requesting the certificate</strong>, <strong>Installing it to the Express app</strong> and <strong>A simple Express app running over TLS</strong>.</p>\n\n<h2 id="requestingthecertificate">Requesting the certificate</h2>\n\n<p>First of all lets get our certificate. I basically just followed the <a href="https://github.com/letsencrypt/letsencrypt/blob/master/README.rst">README inside Let\'s Encrypt\'s Github repo</a>.</p>\n\n<p>We\'ll need to install the utility. This will become easier once it\'s released as stable. You\'ll then be able to use your package-manager.</p>\n\n<pre><code>git clone https://github.com/letsencrypt/letsencrypt\ncd letsencrypt\n./letsencrypt-auto --help\n</code></pre>\n\n<p>Then we can request the certificate. Here\'s what I did for this site.</p>\n\n<pre><code>./letsencrypt-auto certonly --standalone --email not_an_email_address@lucaschmid.net -d lucaschmid.net\n</code></pre>\n\n<p>This threw an error on my server because I had IPv6 enabled. If <a href="https://github.com/letsencrypt/boulder/issues/1046">this issue</a> hasn\'t been resolved yet, <strong>you might need to do deactivate IPv6</strong>, before running the last command.</p>\n\n<pre><code>sysctl -w net.ipv6.conf.all.disable_ipv6=1\n</code></pre>\n\n<p>When you now run the last command again, you should recieve the certificate. After that, you can enable IPv6 again.</p>\n\n<pre><code>sysctl -w net.ipv6.conf.all.disable_ipv6=0\n</code></pre>\n\n<h2 id="installingthecertificatetotheexpressapp">Installing the certificate to the Express app</h2>\n\n<p>Inside my app\'s directory I created a directory called <code>tls</code>. I then created some symlinks for the certificate and the key.</p>\n\n<pre><code>mkdir tls\ncd tls\nln -s /etc/letsencrypt/live/lucaschmid.net/cert.pem\nln -s /etc/letsencrypt/live/lucaschmid.net/privkey.pem key.pem\n</code></pre>\n\n<p><em>I\'m using Docker to run this site, so the symlinks won\'t work inside the container. To fix this, I had to make copies of the files instead of only symlinking them. This has the disadvantage of Letâ€™s Encrypt not being able to manage them. The certificates have a pretty short lifetime (3 months), letsencrypt could renew them itself.</em></p>\n\n<h2 id="asimpleexpressapprunningovertls">A simple Express app running over TLS</h2>\n\n<p>Now we can integrate the <code>https</code> module into our Express server. Here\'s a simple example:</p>\n\n<pre><code>var express = require(\'express\')\nvar fs = require(\'fs\')\nvar https = require(\'https\')\n\nvar ports = process.env.NODE_ENV === \'production\'\n  ? [80, 443]\n  : [3442, 3443]\n\nvar app = express()\n\nvar server = https.createServer(\n  {\n    key: fs.readFileSync(\'./tls/key.pem\'),\n    cert: fs.readFileSync(\'./tls/cert.pem\')\n  },\n  app\n)\n\nserver.listen(ports[1][7])\napp.listen(ports[0])\n\napp.use(\'/\', (req, res) =\\&gt; {\n  res.end(\'Hi\')\n})\n</code></pre>\n\n<p>This script simply serves \'Hi\' on all routes both over HTTP and HTTPS. It might be a good idea to redirect HTTP to HTTPS. I just wanted to keep it as simple as possible here.</p>\n\n<p>When you run this and go to your Website via HTTPS, you should see something like this:\n<img src="/_img/certificate.png" alt="Image of the certificate opened in Firefox" /></p>\n\n<p>Now go on!</p>\n\n<p><strong>ENCRYPT ALL THE THINGS!!</strong></p>' ]
